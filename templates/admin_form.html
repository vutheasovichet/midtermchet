{% extends "admin_base.html" %}
{% if mode == 'add' %}
  {% set page_title = 'Add Product' %}
{% else %}
  {% set page_title = 'Edit Product' %}
{% endif %}
{% block title %}{{ page_title }} â€” Admin{% endblock %}
{% block header %}{{ page_title }}{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <form method="post">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Name</label>
              <input name="name" class="form-control" required
                     value="{{ (item.name if item else '') }}">
            </div>
            <div class="col-md-6">
              <label class="form-label">Category</label>
              <input name="category" class="form-control" required
                     value="{{ (item.category if item else '') }}">
            </div>
            <div class="col-12">
              <label class="form-label">Description</label>
              <textarea name="description" rows="3" class="form-control" required>{{ (item.description if item else '') }}</textarea>
            </div>
            <div class="col-md-4">
              <label class="form-label">Price (USD)</label>
              <input name="price" type="number" step="0.01" class="form-control" required
                     value="{{ (item.price if item else '') }}">
            </div>
            <div class="col-md-8">
              <label class="form-label">Image URL (http/https)</label>
              <input name="image" type="url" pattern="https?://.*" class="form-control" required
                     value="{{ (item.image if item else '') }}">
              <div class="form-text">Paste a direct image URL beginning with http:// or https://</div>
            </div>
            <div class="col-12 d-flex gap-2">
              <button class="btn btn-success" type="submit">
                <i class="bi bi-check2-circle me-1"></i>Save
              </button>
              <a class="btn btn-outline-secondary" href="{{ url_for('admin_list') }}">Cancel</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Live preview -->
  <div class="col-lg-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-body-tertiary">Preview</div>
      <div class="card-body">
        {% set preview_img = (item.image if item else 'https://images.unsplash.com/photo-1504674900247-0877df9cc836') %}
        <img id="preview" class="w-100 rounded" style="aspect-ratio:16/11;object-fit:cover" src="{{ preview_img }}" alt="preview">
        <div class="small text-secondary mt-2">This is a simple preview of the image URL.</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // change preview when typing image url
  const input = document.querySelector('input[name="image"]');
  const preview = document.getElementById('preview');
  if (input && preview){
    input.addEventListener('input', () => {
      if (input.value.startsWith('http')) preview.src = input.value;
    });
  }
</script>
{% endblock %}
